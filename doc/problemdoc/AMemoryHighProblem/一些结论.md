* nmt的结果中的堆内存的提交部分，并不准确，刚启动的服务的不打印log的提交部分也是5120MB.
```declarative
# 下载工具pgcache
wget xiaorui-cc.oss-cn-hangzhou.aliyuncs.com/files/pgcacher
# 给工具授权
chmod +x pgcacher
# 查看进程使用到的cache内存
./pgcacher -pid <pid>

作者：MnameHZJ
链接：https://juejin.cn/post/7321979919674654774
来源：稀土掘金
著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。
```
* rocketmq的日志会占用一定的进程缓存空间.

* jvm已经申请的内存，不会返回给操作系统.
* -XX:+AlwaysPreTouch，启动时候去touch堆内存

* 问题：疑似有问题的地址，是什么区域的内存?0x00007f8eec000000

## cggroup memory info
```declarative
root@app-live-admin-service-prod-gzhy-idc-1283210-ml75f:~#  cat /sys/fs/cgroup/memory/memory.usage_in_bytes
8418189312
root@app-live-admin-service-prod-gzhy-idc-1283210-ml75f:~# cat /sys/fs/cgroup/memory/memory.limit_in_bytes
8589934592
root@app-live-admin-service-prod-gzhy-idc-1283210-ml75f:~# cat /sys/fs/cgroup/memory/memory.stat
cache 99835904
rss 8128270336
rss_huge 0
shmem 0
mapped_file 2162688
dirty 0
writeback 5406720
pgpgin 145263294
pgpgout 143253713
pgfault 1201709916
pgmajfault 0
inactive_anon 0
active_anon 8128462848
inactive_file 91987968
active_file 6205440
unevictable 0
hierarchical_memory_limit 8589934592
total_cache 99835904
total_rss 8128270336
total_rss_huge 0
total_shmem 0
total_mapped_file 2162688
total_dirty 0
total_writeback 5406720
total_pgpgin 145263294
total_pgpgout 143253713
total_pgfault 1201709916
total_pgmajfault 0
total_inactive_anon 0
total_active_anon 8128462848
total_inactive_file 91987968
total_active_file 6205440
total_unevictable 0
```

# 优化思路
* 堆内存调小.
* class区域调小，nmt中的class区域大小，可以通过：-XX:CompressedClassSpaceSize=256M，参考：https://mp.weixin.qq.com/s?__biz=MzkyNTMwMjI2Mw==&mid=2247489471&idx=1&sn=11fb0d30c8bcea50b1bda0b1cd2a6595&chk**=c1c9fb27f6be72314b28d163146ecaa11b298ac9856625cfdc8909d464be6d8b220ef615fd69&scene=21&poc_token=HDlZLWmjM_4fAUF9he0q9DiPPi3RKcM56bXZEpjz
* thread调小，通过线程栈调小，加线程池数量调小.


# 参考：
* 美团的压缩包扫描case:https://www.51cto.com/article/719236.html 
* 内存知识：https://www.pengzna.top/article/Java-Memory/
* 一个内存case：https://www.cnblogs.com/codelogs/p/17659370.html
* log4j2的一个大日志问题分析（京东）：https://developer.jdcloud.com/article/3822